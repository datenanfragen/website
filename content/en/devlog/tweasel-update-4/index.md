{
    "title": "Tweasel update #4: Request database, tracker documentation and legal research",
    "type": "devlog",
    "date": "2023-10-05T19:08:23+02:00",
    "description": "Our tweasel updates are back after the summer. We have made our request data publicly available, such that anyone can run SQL queries against our datasets. We have also better documented many of our TrackHAR adapters. Furthermore, we have begun doing legal research to inform our decisions on how to establish tracker IDs as personal data in our complaints.",
    "authors": [ "baltpeter" ]
}

Now that summer is over, we’re back to our semi-regular updates from the [tweasel project](https://docs.tweasel.org/), where we are building a web app for fighting privacy violations in mobile apps. In this update, we are excited to announce that we have launched our open request database, where anyone can access and query the traffic data that we have collected from thousands of Android and iOS apps. We have also been busy documenting the trackers that we encounter in our data, using various sources and methods to identify the types of personal data that they transmit. Additionally, we have started doing legal research into how to establish tracker IDs as personal data and to prepare for writing our complaint templates.

## TrackHAR and documentation

* We have launched our open request database at [data.tweasel.org](https://data.tweasel.org/). We regularly run traffic analyses on thousands of Android and iOS apps. As we want to enable as many people as possible to look into the inner workings of trackers, we are finally publishing our datasets for other researchers, activists, journalists, and anyone else who is interested in understanding tracking. There are already 250k requests from between January 2021 and July 2023, with more to come in the future.

  {{< img name="data-tweasel-org-screenshot.png" alt="Screenshot of data.tweasel.org, showing a query that returns multiple requests. The screenshot shows seven rows, with the following columns: initiator (e.g. com.amazon.dee.app@2.2.453377.0, com.opera.app.news@11.1.2254.67011), platform (android or ios), endpointUrl (e.g. https://us-u.openx.net/w/1.0/cm, https://csi.gstatic.com/csi), content (one requests has a base64-encoded binary content, another one has an XML document, for the others, the content is blank), and headers." >}}

  To publish the data, we are using the phenomenal [Datasette](https://datasette.io/). We have installed a few plugins to provide even more features, and have written a custom plugin to enhance the display of requests in table views ([source code](https://github.com/tweaselORG/data.tweasel.org), [more details](https://github.com/tweaselORG/meta/issues/33)).
  
  This setup allows anyone to run arbitrary SQL queries (enhanced with additional features by the plugins) against the data. We hope that this will enable others to do investigations that we couldn't even think of. To give just a few (pretty basic) examples of the kinds of queries that can be run:
    * [endpoints that were contacted by the most apps](https://data.tweasel.org/data?sql=select+count(distinct+regex_replace(%27%40.%2B%3F%24%27%2C+coalesce(initiator%2C+%27%3Cno+app+ID%3E%27)%2C+%27%27))+appCount%2C+count(1)+requestCount%2C+endpointUrl+from+requests%0D%0Awhere+endpointUrl+is+not+null%0D%0Agroup+by+endpointUrl++order+by+appCount+desc+limit+101%3B)
    * [requests by a particular app, e.g. Airbnb on Android](https://data.tweasel.org/data?sql=select+link(dataset%2C+id)%2C+initiator%2C+platform%2C+runType%2C+startTime%2C+method%2C+httpVersion%2C+endpointUrl%2C+scheme%2C+host%2C+port%2C+path%2C+content%2C+headers%2C+cookies+%0D%0Afrom+requests%0D%0Awhere+initiator+like+%3AappId+||+%27%40%25%27%0D%0Alimit+101%3B&appId=com.airbnb.android)
    * [longest requests](https://data.tweasel.org/data?sql=select+length(content)+%2B+length(path)+%2B+length(headers)+%2B+length+(cookies)+as+length%2C+link(dataset%2C+id)%2C+initiator%2C+platform%2C+runType%2C+startTime%2C+method%2C+httpVersion%2C+endpointUrl%2C+scheme%2C+host%2C+port%2C+path%2C+content%2C+headers%2C+cookies+from+requests%0D%0Aorder+by+length+desc%0D%0Alimit+10%3B)
* I've been busy [backing up our adapters with proper documentation](https://github.com/tweaselORG/TrackHAR/issues/9) on the reasoning behind why we think properties contain certain data types. In the first prerelease of TrackHAR, we have called most associations "obvious" but we want to do better than that. This is especially important for the complaints later on. It is a very labor-intensive process but this is also one of the main benefits our the adapter approach: We can provide verifiable evidence for each bit of data that we claim was transmitted. In fact, I have found that a surprising number of the trackers (around half) actually have public documentation on these properties that we can reference. Obviously, the companies themselves admitting to which types of data they collect is the best evidence we can get.

  But sometimes, such documentation is not available. We have a [hierarchy of possible justifications](https://trackers.tweasel.org/research) that we go through in those cases: SDK source code, obvious property names, observed values match known device parameters, obvious observed values, experiments.

  So far, I have produced documentation for the following trackers/adapters, adding missing properties and adapters along the way (though none of them are merged or released yet): [Adjust](https://github.com/tweaselORG/TrackHAR/issues/26) ([PR](https://github.com/tweaselORG/TrackHAR/pull/28)), [branch.io v1](https://github.com/tweaselORG/TrackHAR/issues/30) ([PR](https://github.com/tweaselORG/TrackHAR/pull/31)), [Bugsnag](https://github.com/tweaselORG/TrackHAR/pull/51), [Facebook](https://github.com/tweaselORG/TrackHAR/issues/27) ([PR](https://github.com/tweaselORG/TrackHAR/pull/35)), [ioam.de](https://github.com/tweaselORG/TrackHAR/issues/38) ([PR](https://github.com/tweaselORG/TrackHAR/pull/43)), [Microsoft App Center](https://github.com/tweaselORG/TrackHAR/issues/44) ([PR](https://github.com/tweaselORG/TrackHAR/pull/47)), [OneSignal](https://github.com/tweaselORG/TrackHAR/issues/49) ([PR](https://github.com/tweaselORG/TrackHAR/pull/50)), [singular.net](https://github.com/tweaselORG/TrackHAR/issues/16) ([PR](https://github.com/tweaselORG/TrackHAR/pull/24))
* When I started the adapter work, we only had a very basic idea of how we actually wanted to document all this but I decided to just get my feet wet and gain a better understanding of the problem as I worked on it. That sparked some very [in-depth discussions](https://github.com/tweaselORG/meta/issues/3#issuecomment-1682038715). To summarize the main conclusions:
    * Where should the documentation be stored (in pads hosted somewhere, in GitHub issues, in Markdown files in some repo, …)?  
We decided to keep the documentation as [Markdown files in the TrackHAR repo](https://github.com/tweaselORG/TrackHAR/pull/32), such that each page gets its own folder and each property its own file. We glue the sections together using Hugo in the `tracker-wiki` repo (which Lorenz has already [implemented](https://github.com/tweaselORG/tracker-wiki/pull/7)). This way, we can easily reference the reasoning for each property and generate links to the final documentation.
    * [How should we archive the external links that we use as sources for our documentation?](https://github.com/tweaselORG/meta/issues/36)  
This one is particularly tricky. We ideally want to use an established and trusted service like the [Wayback Machine](https://web.archive.org/) but that has issues with lots of the pages we tried (sites blocking the archiving resulting in broken snapshots, dynamic content not being captured properly). The only other public alternative is archive.today, which is heavily gated behind reCAPTCHA and cannot be automated. Meanwhile, the available self-hosted solutions all have their own problems, and we wouldn't be able to host them publicly anyway due to copyright issues. In the end, we decided to create our own solution, keeping that as simple as possible:
        * We store the original links in the `reasoning` field of the adapters, and have a file watcher that tries to archive them using the [Save Page Now API](https://archive.org/details/spn-2-public-api-page-docs-2023-01-22) of archive.org. Errors are recorded in a local file so we can retry using an exponential backoff strategy. Lorenz has mostly [implemented](https://github.com/tweaselORG/TrackHAR/pull/54) this already.
        
          The archived links are stored in a CSV file in the TrackHAR repo and have redirects set up in a subfolder on `trackers.tweasel.org`.
        * If automatic archiving fails, we have to manually create a snapshot on a public archive, likely using archive.today and add that to the CSV.
        * We will manually take screenshots and PDFs of the pages, and upload them to a Nextcloud folder or similar. These can unfortunately not be hosted publicly.
        * We'll create a [linting script](https://github.com/tweaselORG/TrackHAR/issues/33) that warns us on commit if some of the links have not been archived.
    * What do we even want to document, how in-depth do we want to go? Do we always need to reference official documentation if available?  
We decided that we will only document things related to the properties in our adapters to avoid scope creep, even though there are a lot of (disturbingly) interesting admissions on tracker websites. It is fine to use "obvious" as a reasoning if the property name or value is self-explanatory. We do not need to seek out official documentation for every property, but we should update our documentation if we find it later. We also decided that we won't document properties that are listed in official documentation but that we have not observed in our requests, as we only rely on the data we find.
    * How do we document the honey data that we use for our analysis?  
We decided to document the honey data as JSON in the `datasets` table of `data.tweasel.org` and create a nice human-readable view using a plugin.
* To enable the adapter work, I've written a [script for debugging adapters](https://github.com/tweaselORG/TrackHAR/pull/17) that allows you to run an adapter against *all* matching requests in our request database. And as I said, that database (including its API) is public, so *anyone* can use this, not just us.

  {{< img name="trackhar-debug-script-screenshot.png" alt="Screenshot of the debug script being run in a terminal. It shows properties (manfacturer, model, isRooted, carrier, screenHeight, etc.) being matched to values. For example, the values for osVersion are 11 and 13, for isEmulator: true and false, for timezone: 3600000." >}}

  This is quite a powerful tool for ensuring that our adapters are correct—you can quite easily spot transmissions that don't match your initial expectations and correct the adapter accordingly.
* The adapter work has also given rise to quite a few architecture issues and questions for TrackHAR that we'll have to consider:
    * [How do we deal with tracker-specific "empty" values?](https://github.com/tweaselORG/TrackHAR/issues/46), e.g. if `idfa: none` is transmitted, we don't want to identify an IDFA transmission. I've proposed `onlyIf` and `notIf` regex filters in `DataPath`.
    * [How fine-grained do we want to be with our categorisation of proprietary IDs?](https://github.com/tweaselORG/TrackHAR/issues/45). Currently, they all end up as `otherIdentifiers`, but there are various different types. In the complaints, we'll have to [argue for each one why it is personal data](https://github.com/tweaselORG/TrackHAR/issues/25#issuecomment-1735287854). Does that mean that we need a specific property and justification blurb for each possible ID? Or can we maybe get away with just having more granular ID types (session, device, user, installation, …)?
    * [How do we represent transmitted events?](https://github.com/tweaselORG/TrackHAR/issues/37)
    * [I don't think we should list the locale under `country` anymore.](https://github.com/tweaselORG/TrackHAR/issues/22)
    * I proposed [renaming our current `idfa` property to `advertisingId`, and `ifdv` to `developerScopedId`](https://github.com/tweaselORG/TrackHAR/issues/21) to avoid making them sound iOS-specific.
    * We should be more clever in recognizing endpoint URLs, by at least [trimming trailing slashes](https://github.com/tweaselORG/TrackHAR/issues/34).
* Finally, I have started investigating Google's tracking endpoints more thoroughly. Those are mostly not publicly documented and use Protobuf as the transmission format, which doesn't contain any property names that we could rely on. I've made good progress on a [new adapter for `firebaselogging-pa.googleapis.com`](https://github.com/tweaselORG/TrackHAR/issues/52), which is actually the fourth most common endpoint in our dataset (as you can see for yourself on [`data.tweasel.org`](https://data.tweasel.org/data?sql=select+count(distinct+regex_replace(%27%40.%2B%3F%24%27%2C+coalesce(initiator%2C+%27%3Cno+app+ID%3E%27)%2C+%27%27))+appCount%2C+count(1)+requestCount%2C+endpointUrl+from+requests%0D%0Awhere+endpointUrl+is+not+null%0D%0Agroup+by+endpointUrl++order+by+appCount+desc+limit+101%3B)). I've discovered the actual Protobuf schemas for those scattered around various public Google repositories, which will allow us to definitively identify the transmitted properties.

  I've also started [looking into `app-measurement.com`](https://github.com/tweaselORG/TrackHAR/issues/53), but not gotten too far yet.

## Complaints

* I have started doing legal research, looking into relevant complaints, court submissions, decisions, rulings, recommendations, and legal commentary regarding tracking to inform our decisions on how we establish tracker IDs as personal data in our complaints and also prepare for writing our complaint templates. I have collected a [comprehensive list of sources to go through](https://github.com/tweaselORG/meta/issues/38). I am using [Hypothes.is](https://web.hypothes.is/) to organise and annotate them as I go along. Unfortunately, we cannot share these annotations publicly as the source material is copyrighted but I have documented my [main conclusions and learnings](https://github.com/tweaselORG/meta/issues/38#issuecomment-1739101286).

  Based on that research, I am also keeping lists of relevant [decisions/judgements by DPAs and courts](https://github.com/tweaselORG/meta/issues/35), [complaints by others as a reference](https://github.com/tweaselORG/meta/issues/39), and [national implementations of Art. 5(3) ePrivacy directive](https://github.com/tweaselORG/meta/issues/10).

## Outreach

* We gave a (German) [talk for Topio's lecture series "human rights in the digital age"](https://www.datenanfragen.de/verein/event/topio-09-2023/), aimed at a non-technical audience. Topio is a Berlin based non-profit that offers people free support on privacy topics. While the first half of the talk focused on datarequests.org, the second half was about our work into mobile tracking and what we're doing with tweasel. Unfortunately, there is no recording but I created an [annotated presentation](https://github.com/datenanfragen/website/pull/1100) (not merged yet), inspired by Simon Willison.
* Fellow privacy NGO [noyb filed their first three complaints against illegal tracking in mobile apps](https://noyb.eu/en/how-mobile-apps-illegally-share-your-personal-data) with the French CNIL, namely MyFitnessPal, Fnac and SeLoger. We were happy to contribute some insights from our research, which is also cited in the [complaints](https://noyb.eu/sites/default/files/2023-09/Complaint%20Fnac%20EN_redacted.pdf). We are looking forward to see the results of these complaints and will be following them closely to inform our own complaints.

  As we have mentioned before: If you're also working against (mobile) tracking, absolutely do [reach out](https://www.datarequests.org/contact/) so we can collaborate and share our knowledge!

## Libraries

* We have noticed that our tools and libraries are currently broken on Windows. We have identified at least two problems so far: [`appstraction`'s `postinstall` script is broken](https://github.com/tweaselORG/appstraction/issues/118) and [Android emulators don't work](https://github.com/tweaselORG/andromatic/issues/9). Lorenz has [started work on the former](https://github.com/tweaselORG/appstraction/pull/120), finding differences in command separators in \*nix and Windows shells as the problem.
